<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Order Details - Ventus with Address Search</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-image: url('https://i.imgur.com/w2Ihyed.jpeg');
    background-size: cover;
    background-position: center;
    color: white;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  header {
    background: rgba(0, 0, 0, 0.6);
    padding: 20px;
    text-align: center;
    font-size: 2rem;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.5);
  }

  .container {
    flex: 1;
    padding: 30px;
    max-width: 700px;
    margin: 0 auto 40px;
    background: rgba(0, 0, 0, 0.65);
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
  }

  h2 {
    text-align: center;
    margin-bottom: 30px;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
  }

  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
  }

  input, textarea {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 6px;
    margin-bottom: 20px;
    font-size: 1rem;
  }

  input:focus, textarea:focus {
    outline: 2px solid #ffd700;
  }

  #map {
    height: 350px;
    border-radius: 12px;
    margin-bottom: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.7);
  }

  .btn-submit {
    width: 100%;
    background: #ffd700;
    color: black;
    font-weight: bold;
    padding: 14px;
    border: none;
    border-radius: 8px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background 0.3s;
  }

  .btn-submit:hover {
    background: #fff34d;
  }

  footer {
    text-align: center;
    padding: 15px;
    background: rgba(0,0,0,0.6);
    font-size: 0.9rem;
    margin-top: auto;
  }

  .coords {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
  }

  .coords input {
    flex: 1;
  }

  #search-section {
    margin-bottom: 15px;
  }

  #search-section input[type="text"] {
    width: calc(100% - 90px);
    display: inline-block;
  }

  #search-section button {
    width: 80px;
    padding: 12px;
    border: none;
    border-radius: 6px;
    background: #ffd700;
    color: black;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
  }

  #search-section button:hover {
    background: #fff34d;
  }

  #address-display {
    background: rgba(255 255 255 / 0.1);
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 0.95rem;
  }
</style>
</head>
<body>

<header>
  Order Details
</header>

<div class="container">
  <h2>Complete Your Order</h2>
  <form id="orderForm" onsubmit="return handleSubmit(event)">
    <label for="name">Full Name</label>
    <input type="text" id="name" name="name" required placeholder="Enter your full name" />

    <label for="email">Email Address</label>
    <input type="email" id="email" name="email" required placeholder="your@example.com" />

    <label for="phone">Phone Number</label>
    <input type="tel" id="phone" name="phone" required pattern="[0-9+ ]+" placeholder="+62 812 3456 7890" />

    <label for="address">Street Address</label>
    <textarea id="address" name="address" rows="3" required placeholder="Street name, building, block, etc."></textarea>

    <div id="search-section">
      <label for="searchAddress">Search Address</label>
      <input type="text" id="searchAddress" placeholder="Type an address, village, district, city..." />
      <button type="button" onclick="searchAddress()">Search</button>
    </div>

    <div id="map"></div>

    <div class="coords">
      <input type="text" id="lat" name="latitude" placeholder="Latitude" readonly />
      <input type="text" id="lng" name="longitude" placeholder="Longitude" readonly />
    </div>

    <div id="address-display">Selected Address info will appear here.</div>

    <label for="notes">Order Notes</label>
    <textarea id="notes" name="notes" rows="3" placeholder="Any additional instructions?"></textarea>

    <button type="submit" class="btn-submit">Submit Order</button>
  </form>
</div>

<footer>
  &copy; 2025 Ventus. All rights reserved.
</footer>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([-2.5489, 118.0149], 5);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);

  let marker;
  const latInput = document.getElementById('lat');
  const lngInput = document.getElementById('lng');
  const addressDisplay = document.getElementById('address-display');
  const addressTextarea = document.getElementById('address');

  // Pasang marker klik peta
  map.on('click', function(e) {
    placeMarker(e.latlng.lat, e.latlng.lng);
  });

  function placeMarker(lat, lng, displayName = '') {
    if (marker) {
      marker.setLatLng([lat, lng]);
    } else {
      marker = L.marker([lat, lng]).addTo(map);
    }
    latInput.value = lat.toFixed(6);
    lngInput.value = lng.toFixed(6);
    if (displayName) {
      addressDisplay.textContent = displayName;
      // Kita bisa update alamat textarea otomatis (optional)
      addressTextarea.value = displayName;
    } else {
      addressDisplay.textContent = 'Address info not available.';
    }
    // Pusatkan peta ke marker
    map.setView([lat, lng], 15);
  }

  // Fungsi search alamat via Nominatim
  async function searchAddress() {
    const query = document.getElementById('searchAddress').value.trim();
    if (!query) {
      alert('Please enter an address to search.');
      return;
    }
    const url = `https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&q=${encodeURIComponent(query)}&limit=5&countrycodes=id`;
    
    try {
      const res = await fetch(url, { headers: { 'Accept-Language': 'id' } });
      const results = await res.json();
      if (results.length === 0) {
        alert('No results found for that address.');
        return;
      }
      // Pilih hasil pertama
      const place = results[0];
      const lat = parseFloat(place.lat);
      const lon = parseFloat(place.lon);
      let displayName = place.display_name;

      // Ambil kode pos jika ada
      let postcode = '';
      if (place.address && place.address.postcode) {
        postcode = place.address.postcode;
        displayName += `, Postal Code: ${postcode}`;
      }

      placeMarker(lat, lon, displayName);
    } catch (error) {
      alert('Error searching address: ' + error);
    }
  }

  function handleSubmit(event) {
    event.preventDefault();
    const form = event.target;

    const data = {
      name: form.name.value.trim(),
      email: form.email.value.trim(),
      phone: form.phone.value.trim(),
      address: form.address.value.trim(),
      latitude: form.latitude.value,
      longitude: form.longitude.value,
      notes: form.notes.value.trim() || "None"
    };

    if (!data.latitude || !data.longitude) {
      alert("Please select your location on the map or use search.");
      return false;
    }

    const summary = `
Full Name: ${data.name}
Email: ${data.email}
Phone: ${data.phone}
Street Address: ${data.address}
Latitude: ${data.latitude}
Longitude: ${data.longitude}
Notes: ${data.notes}
    `;

    alert("Your order has been successfully submitted!\n\n" + summary);

    form.reset();
    if(marker) {
      map.removeLayer(marker);
      marker = null;
    }
    latInput.value = '';
    lngInput.value = '';
    addressDisplay.textContent = 'Selected Address info will appear here.';
    return false;
  }
</script>

</body>
</html>
