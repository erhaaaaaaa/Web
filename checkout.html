<script>
  const API = 'https://emsifa.github.io/api-wilayah-indonesia/api';
  const prov = document.getElementById('province');
  const city = document.getElementById('city');
  const dist = document.getElementById('district');
  const subd = document.getElementById('subdistrict');
  const post = document.getElementById('postal');

  // Provinsi
  fetch(`${API}/provinces.json`)
    .then(r => r.json())
    .then(data => {
      prov.innerHTML = '<option value="">Select Province</option>';
      data.forEach(p => {
        prov.innerHTML += `<option value="${p.id}">${p.name}</option>`;
      });
    });

  prov.onchange = () => {
    const pid = prov.value;
    city.innerHTML = 'Loading cities...';
    dist.innerHTML = '<option>Select City first</option>';
    subd.innerHTML = '<option>Select District first</option>';
    post.value = '';

    if (!pid) {
      city.innerHTML = '<option>Select Province first</option>';
      return;
    }

    fetch(`${API}/regencies/${pid}.json`)
      .then(r => r.json())
      .then(list => {
        city.innerHTML = '<option value="">Select City</option>';
        list.forEach(c => {
          city.innerHTML += `<option value="${c.id}">${c.name}</option>`;
        });
      });
  };

  city.onchange = () => {
    const cid = city.value;
    dist.innerHTML = 'Loading districts...';
    subd.innerHTML = '<option>Select District first</option>';
    post.value = '';

    if (!cid) {
      dist.innerHTML = '<option>Select City first</option>';
      return;
    }

    fetch(`${API}/districts/${cid}.json`)
      .then(r => r.json())
      .then(list => {
        dist.innerHTML = '<option value="">Select District</option>';
        list.forEach(d => {
          dist.innerHTML += `<option value="${d.id}">${d.name}</option>`;
        });
      });
  };

  dist.onchange = () => {
    const did = dist.value;
    subd.innerHTML = 'Loading subdistricts...';
    post.value = '';

    if (!did) {
      subd.innerHTML = '<option>Select District first</option>';
      return;
    }

    fetch(`${API}/villages/${did}.json`)
      .then(r => r.json())
      .then(list => {
        subd.innerHTML = '<option value="">Select Subdistrict</option>';
        list.forEach(s => {
          subd.innerHTML += `<option value="${s.id}" data-postal="${s.postal_code || ''}">${s.name}</option>`;
        });
      });
  };

  subd.onchange = () => {
    const sel = subd.selectedOptions[0];
    post.value = sel ? sel.dataset.postal : '';
  };
</script>
