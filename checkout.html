<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Order Details - Ventus</title>
  <style>
    /* [Gunakan styling dari form sebelumnya: body, container, btn-submit, dsb.] */
  </style>
</head>
<body>

<header>Order Details</header>
<div class="container">
  <h2>Complete Your Order</h2>
  <form id="orderForm" onsubmit="return handleSubmit(event)">
    <!-- Previous personal fields here... -->
    <label for="province">Province</label>
    <select id="province" name="province" required></select>

    <label for="city">City/Regency</label>
    <select id="city" name="city" required></select>

    <label for="district">District (Kecamatan)</label>
    <select id="district" name="district" required></select>

    <label for="subdistrict">Subdistrict (Kel./Desa)</label>
    <select id="subdistrict" name="subdistrict" required></select>

    <label for="postal">Postal Code</label>
    <input type="text" id="postal" name="postal" required readonly />

    <!-- Address, notes, and submit button -->
  </form>
</div>

<footer>&copy; 2025 Ventus. All rights reserved.</footer>

<script>
  const API = 'https://emsifa.github.io/api-wilayah-indonesia/api';
  const provinceEl = document.getElementById('province');
  const cityEl = document.getElementById('city');
  const districtEl = document.getElementById('district');
  const subdistrictEl = document.getElementById('subdistrict');
  const postalEl = document.getElementById('postal');

  // Fetch provinces
  fetch(`${API}/provinces.json`)
    .then(r => r.json())
    .then(data => {
      provinceEl.innerHTML = '<option value="">Select Province</option>' +
        data.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
    });

  provinceEl.onchange = () => {
    const id = provinceEl.value;
    cityEl.innerHTML = '<option>Loading...</option>';
    districtEl.innerHTML = '<option>Select City first</option>';
    subdistrictEl.innerHTML = '<option>Select District first</option>';
    postalEl.value = '';
    if (!id) return cityEl.innerHTML = '<option>Select Province first</option>';
    fetch(`${API}/regencies/${id}.json`)
      .then(r => r.json())
      .then(data => cityEl.innerHTML = '<option value="">Select City/Regency</option>' +
        data.map(c => `<option value="${c.id}">${c.name}</option>`).join(''));
  };

  cityEl.onchange = () => {
    const id = cityEl.value;
    districtEl.innerHTML = '<option>Loading...</option>';
    subdistrictEl.innerHTML = '<option>Select District first</option>';
    postalEl.value = '';
    if (!id) return districtEl.innerHTML = '<option>Select City first</option>';
    fetch(`${API}/districts/${id}.json`)
      .then(r => r.json())
      .then(data => districtEl.innerHTML = '<option value="">Select District</option>' +
        data.map(d => `<option value="${d.id}">${d.name}</option>`).join(''));
  };

  districtEl.onchange = () => {
    const id = districtEl.value;
    subdistrictEl.innerHTML = '<option>Loading...</option>';
    postalEl.value = '';
    if (!id) return subdistrictEl.innerHTML = '<option>Select District first</option>';
    fetch(`${API}/villages/${id}.json`)
      .then(r => r.json())
      .then(data => subdistrictEl.innerHTML = '<option value="">Select Subdistrict</option>' +
        data.map(s => `<option value="${s.id}" data-postal="${s.postal_code || ''}">${s.name}</option>`).join(''));
  };

  subdistrictEl.onchange = () => {
    const opt = subdistrictEl.selectedOptions[0];
    postalEl.value = opt ? (opt.dataset.postal || '') : '';
  };

  function handleSubmit(e) {
    e.preventDefault();
    const d = new FormData(e.target);
    const summary = `
Full Name: ${d.get('name')}
Email: ${d.get('email')}
Phone: ${d.get('phone')}
Province ID: ${d.get('province')}
City ID: ${d.get('city')}
District ID: ${d.get('district')}
Subdistrict ID: ${d.get('subdistrict')}
Postal Code: ${d.get('postal')}
Street Address: ${d.get('address')}
Notes: ${d.get('notes') || 'None'}
    `;
    alert('Order submitted!\n\n' + summary);
    e.target.reset();
    postalEl.value = '';
  }
</script>
</body>
</html>
