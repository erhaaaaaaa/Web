<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Order Details - Ventus</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-image: url('https://i.imgur.com/w2Ihyed.jpeg');
    background-size: cover;
    background-position: center;
    color: white;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  header {
    background: rgba(0, 0, 0, 0.6);
    padding: 20px;
    text-align: center;
    font-size: 2rem;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.5);
  }

  .container {
    flex: 1;
    padding: 30px;
    max-width: 700px;
    margin: 0 auto;
    background: rgba(0, 0, 0, 0.65);
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
    margin-top: 40px;
  }

  h2 {
    text-align: center;
    margin-bottom: 30px;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
  }

  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
  }

  input, textarea, select {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 6px;
    margin-bottom: 20px;
    font-size: 1rem;
  }

  input:focus, textarea:focus, select:focus {
    outline: 2px solid #ffd700;
  }

  .btn-submit {
    width: 100%;
    background: #ffd700;
    color: black;
    font-weight: bold;
    padding: 14px;
    border: none;
    border-radius: 8px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background 0.3s;
  }

  .btn-submit:hover {
    background: #fff34d;
  }

  footer {
    text-align: center;
    padding: 15px;
    background: rgba(0,0,0,0.6);
    font-size: 0.9rem;
    margin-top: auto;
  }

  #searchContainer {
    position: relative;
    max-width: 100%;
    margin-bottom: 20px;
  }

  #searchInput {
    width: 100%;
    padding: 12px;
    font-size: 1rem;
    border-radius: 6px;
    border: none;
    outline: none;
  }

  #suggestions {
    position: absolute;
    top: 46px;
    width: 100%;
    background: #fff;
    color: #000;
    max-height: 200px;
    overflow-y: auto;
    border-radius: 0 0 6px 6px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    z-index: 1000;
    display: none;
  }

  #suggestions div {
    padding: 8px 12px;
    cursor: pointer;
  }

  #suggestions div:hover {
    background-color: #f0f0f0;
  }

  #map {
    height: 300px;
    border-radius: 12px;
    margin-bottom: 20px;
  }
</style>
</head>
<body>

<header>Order Details</header>

<div class="container">
  <h2>Complete Your Order</h2>
  <form id="orderForm" onsubmit="return handleSubmit(event)">

    <label for="name">Full Name</label>
    <input type="text" id="name" name="name" required placeholder="Enter your full name" />

    <label for="email">Email Address</label>
    <input type="email" id="email" name="email" required placeholder="your@example.com" />

    <label for="phone">Phone Number</label>
    <input type="tel" id="phone" name="phone" required pattern="[0-9+ ]+" placeholder="+62 812 3456 7890" />

    <label for="address">Street Address</label>
    <textarea id="address" name="address" rows="2" required placeholder="Street name, building, block, etc."></textarea>

    <div id="searchContainer">
      <input type="text" id="searchInput" placeholder="Search address or location in Indonesia..." autocomplete="off" />
      <div id="suggestions"></div>
    </div>

    <div id="map"></div>

    <label for="province">Province</label>
    <input type="text" id="province" name="province" readonly />

    <label for="city">City / Regency</label>
    <input type="text" id="city" name="city" readonly />

    <label for="district">District</label>
    <input type="text" id="district" name="district" readonly />

    <label for="postal">Postal Code</label>
    <input type="text" id="postal" name="postal" readonly />

    <label for="notes">Order Notes</label>
    <textarea id="notes" name="notes" rows="3" placeholder="Any additional instructions?"></textarea>

    <button type="submit" class="btn-submit">Submit Order</button>
  </form>
</div>

<footer>
  &copy; 2025 Ventus. All rights reserved.
</footer>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([-2.5489, 118.0149], 5);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);

  let marker;

  const searchInput = document.getElementById('searchInput');
  const suggestions = document.getElementById('suggestions');

  // readonly fields
  const provinceInput = document.getElementById('province');
  const cityInput = document.getElementById('city');
  const districtInput = document.getElementById('district');
  const postalInput = document.getElementById('postal');
  const addressInput = document.getElementById('address');

  let debounceTimer;
  searchInput.addEventListener('input', () => {
    const query = searchInput.value.trim();
    if (query.length < 3) {
      suggestions.style.display = 'none';
      return;
    }

    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
      fetchSuggestions(query);
    }, 300);
  });

  async function fetchSuggestions(query) {
    const url = `https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&q=${encodeURIComponent(query)}&countrycodes=id&limit=5`;
    try {
      const res = await fetch(url, { headers: { 'Accept-Language': 'id' } });
      const results = await res.json();

      if (results.length === 0) {
        suggestions.innerHTML = '<div>No results found</div>';
      } else {
        suggestions.innerHTML = results.map(r => `<div data-lat="${r.lat}" data-lon="${r.lon}" data-display="${r.display_name}" data-address='${JSON.stringify(r.address)}'>${r.display_name}</div>`).join('');
      }
      suggestions.style.display = 'block';
    } catch (error) {
      suggestions.innerHTML = `<div>Error fetching results</div>`;
      suggestions.style.display = 'block';
    }
  }

  suggestions.addEventListener('click', (e) => {
    if (e.target && e.target.dataset.display) {
      const lat = parseFloat(e.target.dataset.lat);
      const lon = parseFloat(e.target.dataset.lon);
      const displayName = e.target.dataset.display;
      const address = JSON.parse(e.target.dataset.address);

      if (marker) {
        marker.setLatLng([lat, lon]);
      } else {
        marker = L.marker([lat, lon]).addTo(map);
      }

      map.setView([lat, lon], 15);

      // isi alamat lengkap di input address
      addressInput.value = displayName;

      // isi provinsi, kota, kecamatan, kode pos kalau ada
      provinceInput.value = address.state || address.county || '';
      cityInput.value = address.city || address.municipality || address.county || '';
      districtInput.value = address.suburb || address.village || address.town || address.hamlet || '';
      postalInput.value = address.postcode || '';

      // isi input search juga supaya tampil alamat lengkapnya
      searchInput.value = displayName;

      suggestions.style.display = 'none';
    }
  });

  document.addEventListener('click', (e) => {
    if (!searchInput.contains(e.target) && !suggestions.contains(e.target)) {
      suggestions.style.display = 'none';
    }
  });

  function handleSubmit(event) {
    event.preventDefault();

    const form = document.getElementById("orderForm");
    const dataForm = new FormData(form);

    const summary = `
Full Name: ${dataForm.get("name")}
Email: ${dataForm.get("email")}
Phone: ${dataForm.get("phone")}
Street Address: ${dataForm.get("address")}
Province: ${dataForm.get("province")}
City: ${dataForm.get("city")}
District: ${dataForm.get("district")}
Postal Code: ${dataForm.get("postal")}
Notes: ${dataForm.get("notes") || "None"}
    `;

    alert("Your order has been successfully submitted!\n\n" + summary);
    form.reset();

    // Clear marker and reset map
    if(marker) {
      map.removeLayer(marker);
      marker = null;
    }
    map.setView([-2.5489, 118.0149], 5);
  }
</script>

</body>
</html>
