<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Leaflet Search Autocomplete</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background:#222; color:#fff; }
  #map { height: 400px; margin-top: 10px; border-radius: 8px; }
  #searchContainer { position: relative; max-width: 500px; }
  #searchInput {
    width: 100%;
    padding: 10px;
    font-size: 1rem;
    border-radius: 6px;
    border: none;
    outline: none;
  }
  #suggestions {
    position: absolute;
    top: 42px;
    width: 100%;
    background: #fff;
    color: #000;
    max-height: 200px;
    overflow-y: auto;
    border-radius: 0 0 6px 6px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    z-index: 1000;
  }
  #suggestions div {
    padding: 8px 12px;
    cursor: pointer;
  }
  #suggestions div:hover {
    background-color: #f0f0f0;
  }
  label { display: block; margin-top: 20px; }
  input[readonly] { background: #333; color: #eee; border-radius: 6px; padding: 8px; border:none; width: 100%; }
</style>
</head>
<body>

<h1>Search Address with Autocomplete</h1>

<div id="searchContainer">
  <input type="text" id="searchInput" placeholder="Type an address or location in Indonesia..." autocomplete="off" />
  <div id="suggestions" style="display:none;"></div>
</div>

<div id="map"></div>

<label>Full Address:</label>
<input type="text" id="fullAddress" readonly />

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([-2.5489, 118.0149], 5);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);

  let marker;

  const searchInput = document.getElementById('searchInput');
  const suggestions = document.getElementById('suggestions');
  const fullAddressInput = document.getElementById('fullAddress');

  let debounceTimer;
  searchInput.addEventListener('input', () => {
    const query = searchInput.value.trim();
    if (query.length < 3) {
      suggestions.style.display = 'none';
      return;
    }

    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
      fetchSuggestions(query);
    }, 300);
  });

  async function fetchSuggestions(query) {
    const url = `https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&q=${encodeURIComponent(query)}&countrycodes=id&limit=5`;
    try {
      const res = await fetch(url, { headers: { 'Accept-Language': 'id' } });
      const results = await res.json();

      if (results.length === 0) {
        suggestions.innerHTML = '<div>No results found</div>';
      } else {
        suggestions.innerHTML = results.map(r => `<div data-lat="${r.lat}" data-lon="${r.lon}" data-display="${r.display_name}">${r.display_name}</div>`).join('');
      }
      suggestions.style.display = 'block';
    } catch (error) {
      suggestions.innerHTML = `<div>Error fetching results</div>`;
      suggestions.style.display = 'block';
    }
  }

  suggestions.addEventListener('click', (e) => {
    if (e.target && e.target.dataset.display) {
      const lat = parseFloat(e.target.dataset.lat);
      const lon = parseFloat(e.target.dataset.lon);
      const displayName = e.target.dataset.display;

      // Set marker
      if (marker) {
        marker.setLatLng([lat, lon]);
      } else {
        marker = L.marker([lat, lon]).addTo(map);
      }

      map.setView([lat, lon], 15);

      // Fill full address only
      fullAddressInput.value = displayName;

      // Set input box text and hide suggestions
      searchInput.value = displayName;
      suggestions.style.display = 'none';
    }
  });

  document.addEventListener('click', (e) => {
    if (!searchInput.contains(e.target) && !suggestions.contains(e.target)) {
      suggestions.style.display = 'none';
    }
  });
</script>

</body>
</html>
